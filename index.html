<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth App</title>
    <!-- Tailwind CSS CDN для стилей -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main Container -->
    <div class="bg-gray-800 p-8 rounded-xl shadow-lg w-full max-w-md">
        <!-- Message Box for user feedback -->
        <div id="messageBox" class="hidden p-4 mb-4 text-sm rounded-lg bg-blue-500 text-white" role="alert">
            <span class="font-medium">Сообщение:</span> <span id="messageText"></span>
        </div>

        <h1 class="text-3xl font-bold text-center text-white mb-6">Аутентификация Firebase</h1>

        <!-- Auth Section -->
        <div id="authSection" class="space-y-4">
            <p class="text-center text-gray-400">Войдите, чтобы продолжить.</p>
            <button id="signInBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300">
                Войти (через кастомный токен)
            </button>
        </div>

        <!-- User Info Section (hidden initially) -->
        <div id="userInfoSection" class="hidden space-y-4 text-center">
            <h2 class="text-2xl font-semibold text-white">Вы вошли в систему</h2>
            <p class="text-gray-400">UID: <span id="userUid" class="font-mono text-white"></span></p>
            <p class="text-gray-400">Email: <span id="userEmail" class="font-mono text-white"></span></p>
            <button id="signOutBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300">
                Выйти
            </button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Импорт необходимых модулей Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // ====================================================================
        // !!! ВАЖНО: ВСТАВЬТЕ ВАШУ КОНФИГУРАЦИЮ FIREBASE ЗДЕСЬ !!!
        // ====================================================================
        // Эту информацию можно найти в настройках вашего проекта Firebase.
        // Она должна быть скопирована из консоли Firebase, секция "Project settings" -> "Your apps".
        // Если вы видите ошибку "Не удалось найти конфигурацию Firebase", значит,
        // эта секция либо пуста, либо неверно заполнена.
        const firebaseConfig = {
            apiKey: "ВАШ_API_КЛЮЧ_ЗДЕСЬ",
            authDomain: "ВАШ_ДОМЕН.firebaseapp.com",
            projectId: "ВАШ_ID_ПРОЕКТА",
            storageBucket: "ВАШ_БАКЕТ.appspot.com",
            messagingSenderId: "ВАШ_MESSAGING_SENDER_ID",
            appId: "ВАШ_APP_ID"
        };
        
        // Переменные для доступа к DOM-элементам
        const authSection = document.getElementById('authSection');
        const userInfoSection = document.getElementById('userInfoSection');
        const signInBtn = document.getElementById('signInBtn');
        const signOutBtn = document.getElementById('signOutBtn');
        const userUidSpan = document.getElementById('userUid');
        const userEmailSpan = document.getElementById('userEmail');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');

        // Функция для отображения сообщений
        function showMessage(text) {
            messageText.textContent = text;
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        }

        let app;
        let auth;
        
        // ====================================================================
        // ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ
        // ====================================================================
        try {
            // Проверка, что конфигурация Firebase не пуста
            if (!firebaseConfig.apiKey || firebaseConfig.apiKey.includes('ВАШ_API_КЛЮЧ_ЗДЕСЬ')) {
                throw new Error("Конфигурация Firebase не найдена. Пожалуйста, вставьте ваши данные в файл.");
            }
            
            // Инициализация Firebase
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            showMessage("Приложение Firebase успешно инициализировано.");
        } catch (error) {
            console.error("Ошибка инициализации Firebase:", error);
            // Отображение ошибки в пользовательском интерфейсе
            authSection.classList.add('hidden');
            userInfoSection.classList.add('hidden');
            showMessage("Ошибка: " + error.message);
        }

        // ====================================================================
        // ЛОГИКА АУТЕНТИФИКАЦИИ
        // ====================================================================

        // Слушатель для изменений состояния аутентификации
        // Эта функция срабатывает каждый раз, когда пользователь входит или выходит из системы
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Пользователь вошел в систему
                console.log("Пользователь вошел:", user);
                authSection.classList.add('hidden');
                userInfoSection.classList.remove('hidden');
                userUidSpan.textContent = user.uid;
                userEmailSpan.textContent = user.email || 'N/A';
                showMessage(`Добро пожаловать, ${user.email || 'пользователь'}!`);
            } else {
                // Пользователь вышел из системы
                console.log("Пользователь вышел.");
                authSection.classList.remove('hidden');
                userInfoSection.classList.add('hidden');
                userUidSpan.textContent = '';
                userEmailSpan.textContent = '';
            }
        });

        // ====================================================================
        // ОБРАБОТЧИКИ СОБЫТИЙ ДЛЯ КНОПОК
        // ====================================================================

        // Обработчик для кнопки входа
        signInBtn.addEventListener('click', async () => {
            // Примечание:
            // Для реального приложения вы должны получить кастомный токен
            // с вашего серверного приложения (например, через Cloud Functions)
            // и передать его сюда. В этом примере мы используем
            // заглушку для демонстрации.
            const fakeCustomToken = "ВАШ_КАСТОМНЫЙ_ТОКЕН_ЗДЕСЬ"; // Замените на реальный токен
            
            try {
                // Подключение с использованием кастомного токена
                // В реальном приложении это будет токен, который вы получили от сервера
                const userCredential = await signInWithCustomToken(auth, fakeCustomToken);
                console.log("Успешный вход:", userCredential.user);
            } catch (error) {
                console.error("Ошибка входа:", error);
                showMessage("Ошибка входа: " + error.message);
            }
        });

        // Обработчик для кнопки выхода
        signOutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                console.log("Выход из системы успешен.");
                showMessage("Вы вышли из системы.");
            } catch (error) {
                console.error("Ошибка выхода:", error);
                showMessage("Ошибка выхода: " + error.message);
            }
        });

    </script>

</body>
</html>
